<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>春天活动-中奖信息V3</title>
    <meta charset="utf-8" name="page-view-size"  content="$size" >

    <!--CSS-->
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/{$platformType}/common.css?t={$time}"/>
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/{$platformType}/Activity/ActivitySpring/V3/winer.css?t={$time}">
    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js?t={$time}"></script>
    <!--公用库-->
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcommon_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmajax_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcore_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmapkplugin.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmmarquee.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmstbutils.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmui_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmintent_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmlog_v1.0.0.js?t={$time}"></script>
    <!--页面跳转-->
    <script type="text/javascript">
        /**
         * 返回事件
         */
        function onBack() {
            LMEPG.Intent.back();
        }
    </script>

</head>
<body style='background-image: url("__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/winners_list_bg_.png")'>
<div id="default_LMEPG.UI.showToast"></div>
<div id="rule">
    <div class="list" id="list">
        <if condition="$platformType eq hd">
            <table id="scoller" style="top: -100px">
         <else />
            <table id="scoller" style="top: -80px">
        </if>
            <!--该部分重复为了实现滚动循环无缝衔接；-->
            <?php foreach($prizeList as $key=>$val):?>
                <tr>
                    <td><?php echo (substr($val['user_account'], 0, 3) ."***". substr($val['user_account'], -3))?></td>
                    <td><?php echo substr($val['prize_dt'], 0, 10)?>
                    </td><td><?php echo $val['prize_name'] ?></td>
                </tr>
            <?php endforeach;?>

        </table>

    </div>
    <div class="list2" id="list2"></div>
</div>
<div id="myprice">
    <table>
        <?php
        if (empty($myPrizeList->list)) { ?>
            <tr>
                <td></td>
                <td>暂无中奖记录</td>
                <td></td>
            </tr>
        <?php } else{
        $val = $myPrizeList->list[0];
        ?>
            <tr>
                <td><?php echo (substr($accountId, 0, 3) ."***". substr($accountId, -3))?></td>
                <td><?php echo substr($val->insert_dt, 0, 10)?></td>
                <td><?php echo $val->prize_name ?></td>
            </tr>
        <?php }?>
    </table>
</div>
<img id="btn-back" src="__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/back_guide_out.png" alt="" />
<img id="win_price_box" src="__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/price_box.png" alt="" />
<div id="myPhone">我的手机号：</div>
<input id="btn-input" type="text"  placeholder="请输入正确的电话号码" alt="" />
<img id="btn-setPhoneNumber" src="__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/save_out.png" alt="" />
<img id="btn-reset" src="__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/resert_out.png" alt="" />
<div id="warm">温馨提示：为了方便奖品发放，请留下您有效的手机号码，所中奖品若是红包，请务必填写有效的电信手机号，否则视为放弃领奖资格!</div>
<script type="text/javascript">
    var scollerSet = -1;//滚动距离
    var timerID3;//定时器
    var newTop;//表单当前位置
    var offSet = 20;//移动单位量，高清25；标清20；
    var lastTop =-12 * offSet;//循环最大值，当位置到达最大值循环开始；

    // 当前页面使用图片路径目录
    var imgPathPrefix = '__ROOT__/Public/img/{$platformType}/Activity/ActivitySpring/V3/';

    var buttons = [
        {
            id: 'btn-back',
            name: '',
            type: 'img',
            nextFocusLeft: 'btn-input',
            nextFocusRight: '',
            nextFocusUp: '',
            nextFocusDown: 'btn-input',
            backgroundImage: imgPathPrefix + 'back_guide_out.png',
            focusImage: imgPathPrefix + 'back_guide_in.png',
            click: "onClick()",
            focusChange: "",
            beforeMoveChange: '',
            moveChange: "",
        },
        {
            id: 'btn-input',
            name: '',
            type: 'img',
            nextFocusLeft: '',
            nextFocusRight: '',
            nextFocusUp: 'btn-back',
            nextFocusDown: 'btn-setPhoneNumber',
            backgroundImage: '',
            focusImage: '',
            click: "",
            focusChange: _onFocus,
            beforeMoveChange: '',
            moveChange: "",
        },
        {
            id: 'btn-setPhoneNumber',
            name: '',
            type: 'img',
            nextFocusLeft: '',
            nextFocusRight: 'btn-reset',
            nextFocusUp: 'btn-input',
            nextFocusDown: '',
            backgroundImage: imgPathPrefix + 'save_out.png',
            focusImage: imgPathPrefix + 'save_in.png',
            click: "onClick()",
            focusChange: "",
            beforeMoveChange: '',
            moveChange: "",
        },
        {
            id: 'btn-reset',
            name: '',
            type: 'img',
            nextFocusLeft: 'btn-setPhoneNumber',
            nextFocusRight: 'btn-back',
            nextFocusUp: 'btn-input',
            nextFocusDown: '',
            backgroundImage: imgPathPrefix + 'resert_out.png',
            focusImage: imgPathPrefix + 'resert_in.png',
            click: "onClick()",
            focusChange: "",
            beforeMoveChange: '',
            moveChange: "",
        },
    ];

    window.onload = function () {
        var prizeList = parseInt('<?php echo $prizeListCount?>');
        if(prizeList <= 4){
            G("scoller").style.top = "0px";
        } else{
            G("scoller").innerHTML += G("scoller").innerHTML;
            directionY();
        }
        LMEPG.ButtonManager.init(['btn-input'], buttons, '', true);
        getPhoneNumber();
    }

    //号码框焦点事件
    function _onFocus(btn,HasFocus) {
        dom = G(btn.id);
        if(HasFocus){
            dom.disabled=false;
            dom.focus();
        } else {
            dom.disabled=true;
            dom.blur();
        }
    }

    //活动手纵向平移
    function directionY() {
        try {
            Marquee();
            timerID3 = setTimeout("directionY()", 50);
        } catch (e) {
        }

    }

  //滚动定时器实现表单滚动
    function Marquee(){
        hand = G("scoller");
        newTop = parseInt(hand.style.top);
        hand.style.top = newTop + scollerSet +"px";
        if (newTop == lastTop) {
            hand.style.top = -100 + "px";
        }
    }

    function onClick() {
        var currentButton = LMEPG.ButtonManager.getCurrentButton();
        if (currentButton != null) {
            var id = currentButton.id;
        } else {
            return;
        }
       if (id == "btn-back") {
          LMEPG.Intent.back();
        } else if (id == "btn-setPhoneNumber") {
            var phoneTex = G("btn-input");
            var userTel = phoneTex.value;
            var myPrices = '<?php echo json_encode($myPrizeList)?>';
            var jsonMyPrices = JSON.parse(myPrices);
            if(jsonMyPrices.list == null ||jsonMyPrices.list.length < 1){
                LMEPG.UI.showToast("没有中奖！", 3);
                return;
            }
            var prizeIdx = jsonMyPrices.list[0].prize_idx;
            if(prizeIdx == null){
                LMEPG.UI.showToast("没有中奖！", 3);
                return;
            }
            if (LMEPG.Func.isTelPhoneMatched(userTel)) {
                goSetPhoneNumber(userTel, prizeIdx);
            } else {
                LMEPG.UI.showToast("请输入有效的手机号码");
            }
        } else if (id == "btn-reset") {
           var phoneTex = G("btn-input");
           phoneTex.value="";
       }

    }

    /**
     * 获取中奖电话号码
     */
    function getPhoneNumber() {
        LMEPG.ajax.postAPI('Activity/getPhoneNumber', null,
            function (rsp) {
                try {
                    var data = rsp instanceof Object ? rsp : JSON.parse(rsp);
                    if (data.result == 0) {
                        var list = data.list;
                        for (var i = 0; i < list.length; i++) {
                            var itemList = list[i];
                            var tel = itemList["user_tel"];
                            if (tel != null && tel != "") {
                                G("btn-input").value = tel;
                                break;
                            }
                        }
                    }
                } catch (e) {
                    LMEPG.UI.showToast("获取中奖手机号，结果处理异常！");
                    LMEPG.Log.error(e.toString());
                }
            },
            function (rsp) {
                LMEPG.UI.showToast("请求获取中奖手机号，发生错误！");
            }
        );
    }

    /**
     * 去设置中奖电话号码
     * @param userTel
     * @param prizeIdx
     */
    function goSetPhoneNumber(userTel, prizeIdx) {
        var reqData = {
            "phoneNumber": userTel,
            "prizeIdx": prizeIdx
        };
        LMEPG.ajax.postAPI('Activity/setPhoneNumber', reqData,
            function (rsp) {
                try {
                    var data = rsp instanceof Object ? rsp : JSON.parse(rsp);
                    var result = data.result;
                    if (result == 0) {  // 设置号码成功
                        LMEPG.UI.showToast("提交成功");
                    } else { // 设置号码失败
                        LMEPG.UI.showToast("提交失败，请重试！");
                    }
                } catch (e) {
                    LMEPG.UI.showToast("保存手机号结果处理异常！");
                    LMEPG.Log.error(e.toString());
                }
            },
            function (rsp) {
                LMEPG.UI.showToast("请求保存手机号发生错误！");
            }
        );
    }

</script>
</body>
</html>