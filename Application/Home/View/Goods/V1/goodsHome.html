<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>设备商城</title>
    <meta charset="utf-8" name="page-view-size" content='{$size}'>

    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/hd/common.css?t={$time}"/>

    <script type="text/javascript">
        var ROOT = "__ROOT__";
        var RenderParam = {
            // 公共渲染
            carrierId: "{$carrierId}",          // 地区id
            areaCode: "{$areaCode}",            // 省份地区码
            subAreaCode: "{$subAreaCode}",      // 省份下的子区域
            platformType: "{$platformType}",    // 平台类型
            debug: "{$debug}",                  // 调试模式
            pageSize: "{$size}",            // 页面尺寸
            stbModel: "{$stbModel}",                            // 盒子的型号
            fsUrl: "{$resourcesUrl}",           // fs 地址
            time: "{$time}",                    // 开始渲染时间
            userId: "{$userId}",                // 用户Id
            accountId: "{$accountId}",                // 用户Id
            focusIndex: "{$focusIndex}",                        // 焦点ID
            focusBackId: "{$focusBackId}",                        // 焦点ID
            isVip: {$isVip}                                    // 用户是否是vip
        };
    </script>

    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js?t={$time}"></script>
    <!--公用库-->
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcommon.js?t={$time}"></script>
<eq name="isRunOnAndroid" value="1">
    <script type="text/javascript" src="__ROOT__/Public/Common/js/android.js?t={$time}"></script>
</eq>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmUI.js?t={$time}"></script>
    <!--模块-->
    <script type="text/javascript" src="__ROOT__/Public/js/Goods/GoodsAPI.js?t={$time}"></script>

    <style>
        .title {
            position: absolute;
            left: 80px;
            top: 38px;
            line-height: 37px;
            font-size: 37px;
            color: #FFFFFF;
            font-weight: bold;
        }

        .title-line {
            position: absolute;
            left: 80px;
            top: 87px;
            width: 150px;
            height: 2px;
        }

        #eq-list > img {
            width: 462px;
            height: 354px;
            border-radius: 15px;
        }

        #device-1 {
            position: absolute;
            top: 219px;
            left: 146px;
        }

        #device-2 {
            position: absolute;
            top: 219px;
            left: 676px;
        }

        .icon-left {
            position: absolute;
            top: 375px;
            left: 73px;
            display: none;
        }

        .icon-right {
            position: absolute;
            top: 375px;
            left: 1183px;
            display: none;
        }

        #pages {
            position: absolute;
            top: 646px;
            left: 616px;
            width: 50px;
            height: 30px;
            font-size: 24px;
            color: #fff;
        }

        #bugRecord {
            position: absolute;
            top: 26px;
            left: 1016px;
            padding: 5px 20px;
        }

        .no-data {
            width: 1280px;
            height: 720px;
            line-height: 720px;
            text-align: center;
            font-size: 36px;
            display: none;
            color: #ffffff;
            position: absolute;
        }

        #back{
            position: absolute;
            top: 414px;
            left: 544px;
        }
    </style>
</head>
<body>
<div class="title">设备商城</div>
<img class="title-line" src="__ROOT__/Public/img/hd/Home/V15/Home/line.png"/>
<div id="eq-list"></div>
<img id="icon-left" class="icon-left" src="__ROOT__/Public/img/hd/Goods/V1/icon_left_arrow.png"/>
<img id="icon-right" class="icon-right" src="__ROOT__/Public/img/hd/Goods/V1/icon_right_arrow.png"/>
<div id="pages"></div>
<div id="no-data" class="no-data">正在备货中...</div>
<img id="back" src="" alt="">

<script type="text/javascript">
    // 返回按键
    function onBack() {
        LMEPG.Intent.back();
    }

    //页面跳转控制
    var Jump = {

        /**
         * 获取当前页面对象
         */
        getCurrentPage: function () {
            var currentPage = LMEPG.Intent.createIntent("goodsHome");
            currentPage.setParam("pageCurrent", List.pageCurrent);
            currentPage.setParam("focusId", LMEPG.BM.getCurrentButton().id);
            return currentPage;
        },
        /**
         * 跳转 -- 付款
         * @param activityName
         */
        jumpDetail: function () {
            var objCurr = Jump.getCurrentPage();
            var objDetail = LMEPG.Intent.createIntent("goodsDetail");
            var goodInfo = LMEPG.BM.getCurrentButton().cGoodInfo;
            objDetail.setParam("goodInfo", goodInfo);
            LMEPG.Intent.jump(objDetail, objCurr);
        }

    };

    var Pages = {
        recommendFocus: function (btn, hasFocus) {
            if (hasFocus) {
                LMEPG.CssManager.addClass(btn.id, "recommended-hover");
            } else {
                LMEPG.CssManager.removeClass(btn.id, "recommended-hover");
            }
        },

        btnFocus: function (btn, hasFocus) {
            if (hasFocus) {
                LMEPG.CssManager.addClass(btn.id, "btn-hover");
            } else {
                LMEPG.CssManager.removeClass(btn.id, "btn-hover");
            }
        },
        /**
         * 按键移动前事件
         */
        onBeforeMoveChange: function (direction, current) {
            //翻页
            switch (direction) {
                case "right":
                    if (current.id == "device-2") {
                        List.nextMenu();
                        return false;
                    }
                    break;
                case "left":
                    if (current.id == "device-1") {
                        List.preMenu();
                        return false;
                    }
                    break;
            }
        }
    };

    var buttons = [
        {
            id: 'device-1',
            name: '设备',
            type: 'img',
            nextFocusLeft: '',
            nextFocusRight: 'device-2',
            nextFocusUp: 'bugRecord',
            nextFocusDown: '',
            backgroundImage: '',
            focusImage: '',
            cGoodInfo: "",
            click: Jump.jumpDetail,
            focusChange: Pages.recommendFocus,
            beforeMoveChange: Pages.onBeforeMoveChange
        },
        {
            id: 'device-2',
            name: '设备',
            type: 'img',
            nextFocusLeft: 'device-1',
            nextFocusRight: '',
            nextFocusUp: 'bugRecord',
            nextFocusDown: '',
            backgroundImage: '',
            focusImage: '',
            cGoodInfo: "",
            click: Jump.jumpDetail,
            focusChange: Pages.recommendFocus,
            beforeMoveChange: Pages.onBeforeMoveChange
        }
    ];

    window.onload = function () {
        document.body.style.backgroundImage = 'url(__ROOT__/Public/img/hd/Home/V15/Home/bg.png)';
        List.init();//初始化页面
    };

    var List = {
        pageCurrent: {$pageCurrent},
        focusId: "{$focusId}",
        pageNum: 2,
        pageTotal: 0,
        isNextTurnPage: false,
        isFirstLoad: true,
        init: function () {
            GoodsAPI.getGoodsInfo(List.pageCurrent, List.pageNum, function (data) {
                List.createMenu(data);
            });
        },

        // 创建菜单
        createMenu: function (data) {
            if (data.result != "0") {
                LMEPG.UI.showToast("获取异常:" + data.result);
                LMEPG.ButtonManager.init("", "", '', true);
                return;
            }

            List.pageTotal = Math.ceil(data.count / this.pageNum);
            var retArr = data.list;
            if (retArr.length < 1) {
                Show("no-data");
                LMEPG.ButtonManager.init("back", [{
                    id: "back",
                    type: 'img',
                    backgroundImage: "__ROOT__/Public/img/hd/Goods/V1/back.png",
                    focusImage: "__ROOT__/Public/img/hd/Goods/V1/back_f.png",
                    click:onBack
                }], '', true);
                return;
            }
            G("eq-list").innerHTML = "";
            var strTable = '';
            for (var i = 0; i < (retArr.length); i++) {
                var imgUrl = RenderParam.fsUrl + retArr[i].goods_img_url;
                strTable += '<img id="device-' + (i + 1) + '"  src="' + imgUrl + '"/> ';
                retArr[i].service_tel = data.service_tel;
                buttons[i].cGoodInfo = retArr[i];
            }
            G("eq-list").innerHTML = strTable;
            G("pages").innerHTML = List.pageCurrent + "/" + List.pageTotal;
            List.updateArrow();

            if (this.isFirstLoad) {
                this.isFirstLoad = false;
                LMEPG.ButtonManager.init(List.focusId, buttons, '', true);
            } else {
                if (this.isNextTurnPage) {
                    LMEPG.ButtonManager.init('device-1', buttons, '', true);
                } else {
                    LMEPG.ButtonManager.init('device-2', buttons, '', true);
                }
            }

        },

        updateArrow: function () {
            var pageRight = document.getElementById("icon-right");
            var pageLeft = document.getElementById("icon-left");
            pageRight.style.display = "none";
            pageLeft.style.display = "none";
            if (List.pageCurrent < List.pageTotal) {
                pageRight.style.display = "block";
            }
            if (List.pageCurrent > 1) {
                pageLeft.style.display = "block";
            }

        },

        preMenu: function () {  //遥控器左按键翻页
            if (this.pageCurrent > 1) {
                this.isNextTurnPage = false;
                this.pageCurrent--;
                this.init();
                LMEPG.ButtonManager.requestFocus("device-2");
            }
        },

        nextMenu: function () {
            if (this.pageCurrent < this.pageTotal) {
                this.isNextTurnPage = true;
                this.pageCurrent++;
                this.init();
                LMEPG.ButtonManager.requestFocus("device-1");
            }
        }

    }

</script>
</body>
</html>