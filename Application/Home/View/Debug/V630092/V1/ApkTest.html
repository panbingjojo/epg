<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>青海电信EPG-启动APK</title>
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/{$platformType}/common.css?t={$time}"/>

    <!--全局渲染参数-->
    <script type="text/javascript">
        var RenderParam = {
            //公共渲染
            carrierId: "{$carrierId}",          // 地区id
            areaCode: "{$areaCode}",            // 省份地区码
            subAreaCode: "{$subAreaCode}",      // 省份下的子区域
            platformType: "{$platformType}",    // 平台类型
            debug: "{$debug}",                  // 调试模式
            pageSize: "{$size}",                // 页面尺寸
            stbModel: "{$stbModel}",            // 盒子的型号
            fsUrl: "{$resourcesUrl}",           // fs 地址
            time: "{$time}",                    // 开始渲染时间
            isVip: {$isVip},                    // 用户是不是vip，1 -- 是vip
            userId: "{$userId}",                // 用户Id
            accountId: "{$accountId}",          // 用户Id
            returnUrl: "{$returnUrl}",          // 父页面
            focusId: "{$focusId}",              // 默认焦点

            //当前页渲染
            appName: "{$appName}",
            appUrl: "{$appUrl}",
        }
    </script>
    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js?t={$time}"></script>
    <!--公用库-->
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcommon.js?t={$time}"></script>
<eq name="isRunOnAndroid" value="1">
    <script type="text/javascript" src="__ROOT__/Public/Common/js/android.js?t={$time}"></script>
</eq>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmui.js?t={$time}"></script>
    <!--当前模块js-->

    <style type="text/css">
        #checkApk{
            position: absolute;
            width: 170px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 20px;
        }
        #startApk{
            position: absolute;
            width:150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 230px;
        }
        #startAppMarket{
            position: absolute;
            width:150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 450px;
        }
        #startAppMarketDetail{
            position: absolute;
            width:220px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 670px;
        }
    </style>
</head>
<body style="background-image: url('../../../../../../Public/img/{$platformType}/Common/{$commonImgsView}/bg_home.png');
    background-Repeat: no-repeat; width: 1280px;height: 720px;position: relative;">
<div id="debug" style=" display: block;color:white;z-index:999;"></div>
<div id="checkApk">检测是否安装APK</div>
<div id="startApk">启动APK</div>
<div id="startAppMarket">启动应用商城</div>
<div id="startAppMarketDetail">启动应用商城插件详情</div>
<!--提示弹框-->
<div id="default_tip"></div>
</body>

<script type="text/javascript">
    buttons = [
        {
            id: 'checkApk',
            name: '检测是否安装APK',
            type: 'img',
            nextFocusLeft: '',
            nextFocusRight: 'startApk',
            focusChange:onFocusBtn,
            click: onClick,
        }, {
            id: 'startApk',
            name: '启动APK',
            type: 'img',
            nextFocusLeft: 'checkApk',
            nextFocusRight: 'startAppMarket',
            focusChange:onFocusBtn,
            click: onClick,
        },{
            id: 'startAppMarket',
            name: '启动应用商城',
            type: 'img',
            nextFocusLeft: 'startApk',
            nextFocusRight: 'startAppMarketDetail',
            focusChange:onFocusBtn,
            click: onClick,
        },{
            id: 'startAppMarketDetail',
            name: '启动应用商城插件详情',
            type: 'img',
            nextFocusLeft: 'startAppMarket',
            nextFocusRight: '',
            focusChange:onFocusBtn,
            click: onClick,
        }];

    function onFocusBtn(btn, hasFocus) {
        if (hasFocus == true) {
            G(btn.id).style.background = 'blue';
            G(btn.id).style.color = '#ffffff';
        } else {
            G(btn.id).style.background = '#ffffff';
            G(btn.id).style.color = 'black';
        }
    }

    function onClick(btn) {
        switch (btn.id) {
            case "checkApk":
                checkIsInstallApp();
                break;
            case "startApk":
            case "intentStartApk":
                startApp(RenderParam.appName);
                break;
            case "startAppMarket":
                startAppMarket();
                break;
            case "startAppMarketDetail":
                startAppMarketDetail();
                break;
            default:
                LMEPG.UI.showToast("不支持该操作");
        }
    }
</script>

<script type="text/javascript">
    var debug = document.getElementById("debug");

    function checkIsInstallApp() {
        var install = LMEPG.ApkPlugin.isAppInstall(RenderParam.appName);
        if (install && install != "undefined") {
            LMEPG.UI.showToast("此盒子已安装APK");
        } else {
            LMEPG.UI.showToast("此盒子未安装APK");
        }
    }

    function startApp(appName) {
        var install = LMEPG.ApkPlugin.isAppInstall(appName);
        if (install && install != "undefined") {
            LMEPG.ApkPlugin.startAppByName(appName);
        } else {
            startAppMarketDetail();
        }
    }

    function startAppMarket() {
        // 如果apk没有安装，则打开应用市场首页
        var appName = "com.amt.appstore"; // 商城包名，根据具体版本而定，不一定是 “com.amt.appstore”
        var extraString = "jumpId=0";
        var intentMessage = '{"intentType":1,' +
            '"appName":"' + appName + '",' +
            '"action":"' + "com.amt.appstore.action.LAUNCHER" + '",' +
            '"extra":[{"name":"extraKey","value":"' + extraString + '"}]}';

        console.log(intentMessage);
        STBAppManager.startAppByIntent(intentMessage);
    }

    function startAppMarketDetail() {
        // 如果apk没有安装，则打开应用市场的详情页
        var appName = "com.amt.appstore"; // 商城包名，根据具体版本而定，不一定是 “com.amt.appstore”
        var extraString = "jumpId=8&appPkg=" + "com.longmaster.iptv.healthplugin.video.qinghaidx" + "&appId=" + "408";
        var intentMessage = '{"intentType":1,' +
            '"appName":"' + appName + '",' +
            '"action":"' + "com.amt.appstore.action.LAUNCHER" + '",' +
            '"extra":[{"name":"extraKey","value":"' + extraString + '"}]}';

        console.log(intentMessage);
        STBAppManager.startAppByIntent(intentMessage);
    }

    //页面加载完成
    window.onload = function () {
        // 初始焦点在第一个
        LMEPG.ButtonManager.init('checkApk', buttons, '', true);

        if (typeof STBAppManager == "undefined") {
            debug.innerHTML = "STBAppManager undefined";
        } else {
            debug.innerHTML = "STBAppManager start test";
        }
    };

    function onBack() {
        LMEPG.Intent.back();
    }
</script>
</html>