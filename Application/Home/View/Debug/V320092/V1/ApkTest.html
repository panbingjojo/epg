<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>江苏电信EPG调用APK</title>
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/{$platformType}/common.css?t={$time}"/>

    <!--全局渲染参数-->
    <script type="text/javascript">
        var RenderParam = {
            //公共渲染
            carrierId: "{$carrierId}",          // 地区id
            areaCode: "{$areaCode}",            // 省份地区码
            subAreaCode: "{$subAreaCode}",      // 省份下的子区域
            platformType: "{$platformType}",    // 平台类型
            debug: "{$debug}",                  // 调试模式
            pageSize: "{$size}",                // 页面尺寸
            stbModel: "{$stbModel}",            // 盒子的型号
            fsUrl: "{$resourcesUrl}",           // fs 地址
            time: "{$time}",                    // 开始渲染时间
            isVip: {$isVip},                    // 用户是不是vip，1 -- 是vip
            userId: "{$userId}",                // 用户Id
            accountId: "{$accountId}",          // 用户Id
            returnUrl: "{$returnUrl}",          // 父页面
            focusId: "{$focusId}",              // 默认焦点

            //当前页渲染
            appName: "{$appName}",
            appUrl: "{$appUrl}",
        }
    </script>

    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js?t={$time}"></script>
    <!--公用库-->
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcommon.js?t={$time}"></script>
<eq name="isRunOnAndroid" value="1">
    <script type="text/javascript" src="__ROOT__/Public/Common/js/android.js?t={$time}"></script>
</eq>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmui.js?t={$time}"></script>
    <!--当前模块js-->

    <style type="text/css">
        #checkApk {
            position: absolute;
            width: 170px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 20px;
        }

        #installApk {
            position: absolute;
            width: 150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 230px;
        }

        #startApk {
            position: absolute;
            width: 150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 450px;
        }

        #startAppMarket {
            position: absolute;
            width: 150px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-size: 19px;
            background: #FFFFFF;
            left: 670px;
        }
    </style>
</head>
<body style="background-image: url('__ROOT__/Public/img/{$platformType}/Common/{$commonImgsView}/bg_home.png');
    background-Repeat: no-repeat; width: 1280px;height: 720px;position: relative;">
<div id="debug" style=" display: block;color:white;z-index:999;"></div>
<div id="checkApk">检测是否安装APK</div>
<div id="installApk">安装APK</div>
<div id="startApk">启动APK</div>
<div id="startAppMarket">启动应用商城</div>
<!--提示弹框-->
<div id="default_tip"></div>
</body>

<script type="text/javascript">
    buttons = [
        {
            id: 'checkApk',
            name: '检测是否安装APK',
            type: 'img',
            nextFocusLeft: '',
            nextFocusRight: 'installApk',
            focusChange: onFocusBtn,
            click: onClick,
        }, {
            id: 'installApk',
            name: '安装APK',
            type: 'img',
            nextFocusLeft: 'checkApk',
            nextFocusRight: 'startApk',
            focusChange: onFocusBtn,
            click: onClick,
        }, {
            id: 'startApk',
            name: '启动安装',
            type: 'img',
            nextFocusLeft: 'installApk',
            nextFocusRight: 'startAppMarket',
            focusChange: onFocusBtn,
            click: onClick,
        }, {
            id: 'startAppMarket',
            name: '启动应用商城',
            type: 'img',
            nextFocusLeft: 'startApk',
            nextFocusRight: '',
            focusChange: onFocusBtn,
            click: onClick,
        }];

    function onFocusBtn(btn, hasFocus) {
        if (hasFocus == true) {
            G(btn.id).style.background = 'blue';
            G(btn.id).style.color = '#ffffff';
        } else {
            G(btn.id).style.background = '#ffffff';
            G(btn.id).style.color = 'black';
        }
    }

    function onClick(btn) {
        switch (btn.id) {
            case "checkApk":
                checkIsInstallApp();
                break;

            case "installApk":
                installApp();
                break;

            case "startApk":
            case "intentStartApk":
                goStartAPK();
                break;

            case "startAppMarket":
                startAppMarket();
                break;
            default:
                LMEPG.UI.showToast("不支持该操作");
        }

    }

    function goStartAPK() {
        LMEPG.ajax.postAPI("Debug/getTestAPKInfo", null, function (rsp) {
            try {
                var data = rsp instanceof Object ? rsp : JSON.parse(rsp);
                startAppByIntent(data.param_info);
            } catch (e) {
                LMEPG.UI.showToast("获取问诊参数，解析异常");
            }
        }, function (rsp) {
            LMEPG.UI.showToast("获取问诊参数请求失败");
        });
    }

    function startAppMarket() {
        var appName = "com.itv.android.iptv";     // TV中心商城
//        LMEPG.ApkPlugin.startAppByName(appName);
        Utility.setValueByName("exitIptvApp");
    }
</script>

<script type="text/javascript">
    var debug = document.getElementById("debug");

    function installApp() {
        LMEPG.UI.showToast("正在安装APK==》" + RenderParam.appUrl);
        LMEPG.ApkPlugin.installApp(RenderParam.appUrl);
    }

    function startApp(appName) {
        LMEPG.ApkPlugin.startAppByName(appName);
    }

    function startAppByIntent(intentMessage) {
        debug.innerHTML += intentMessage + "<br>";
        try {
            debug.innerHTML += "<br> go STBAppManager.startAppByIntent...";
            LMEPG.ApkPlugin.startAppByIntent(intentMessage);
        } catch (e) {
            debug.innerHTML += "<br>" + e.toString();
        }
    }

    function checkIsInstallApp() {
        LMEPG.UI.showToast("安装APK？" + RenderParam.appName, 5);
        var install = appManager.isInstall(RenderParam.appName);
        if (install) {
            LMEPG.UI.showToast("此盒子已安装APK");
        } else {
            LMEPG.UI.showToast("此盒子未安装APK");
        }
    }

    //页面加载完成
    window.onload = function () {
        // 初始焦点在第一个
        LMEPG.ButtonManager.init('checkApk', buttons, '', true);

        if (typeof STBAppManager == "undefined") {
            debug.innerHTML = "STBAppManager undefined";
        } else {
            debug.innerHTML = "STBAppManager start test";
        }
    };

    function onBack() {
        window.location.href = "{$homeUrl}";
    }
</script>
</html>