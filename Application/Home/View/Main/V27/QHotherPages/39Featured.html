<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>健康图文</title>

    <!--全局变量-->
    <script type="text/javascript">
        var ROOT = "__ROOT__";
    </script>
    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js"></script>
    <!--公共库-->
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmcommon_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmajax_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmcore_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmintent_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmplayer_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmui_v1.0.1.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmstbutils.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/lmlog_v1.0.0.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/common/js/android.js?t={$time}"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            outline: none;
            background-repeat: no-repeat;
            background-position: center;
            font-family: 'Source Han Sans CN';
        }

        body {
            width: 1280px;
            height: 720px;
            position: relative;
            background-position: left;
            background-image: url(__ROOT__/Public/img/Menu/QHotherPages/39_featured_bg.png);
        }

        body > * {
            position: absolute;
        }

        #back {
            top: 18px;
            left: 1208px;
        }

        #container {
            top: 39px;
            left: 660px;
            width: 544px;
            height: 637px;
            background-image: url(__ROOT__/Public/img/Menu/QHotherPages/wrap_bg.png);
        }

        #container ul {
            margin-top: 100px;
            list-style-position: inside;
            /*margin-left: 25px;*/
        }

        #container li {
            width: 440px;
            margin-top: 7px;
            margin-left: 11px;
            padding: 10px;
            padding-right: 70px;
            vertical-align: middle;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            /*text-align: center;*/
            text-indent: 30px;
            font-size: 28px;
            color: #fff;
        }

        #container li marquee {
            margin-right: 66px;
        }

        #container li.focus {
            background-image: url(__ROOT__/Public/img/Menu/QHotherPages/item_f.png);
            /*background-size: 100% 100%;*/
        }

        #page-index {
            top: 675px;
            left: 918px;
            font-size: 21px;
            color: #fff;
        }

        #iframe {
            width: 1280px;
            height: 720px;
            top: 0;
            left: 0;
            z-index: 99;
            display: none;
            background-image: url(__ROOT__/Public/img/Menu/QHotherPages/bg_waiting_dialog.gif);
        }

        #img-container {
            position: absolute;
            top: 0;
            left: 0;
        }

        #left-arrow {
            position: absolute;
            z-index: 100;
            top: 50%;
        }

        #right-arrow {
            position: absolute;
            top: 50%;
            right: 30px;
        }
    </style>
</head>
<body>
<img id="back" src="__ROOT__/Public/img/Menu/QHotherPages/back.png" alt="">
<div id="container">
    <ul id="item-wrapper">

    </ul>
</div>
<div id="page-index">0/0</div>
<div id="iframe">
    <img src="__ROOT__/Public/img/Menu/common/prev.png" id="left-arrow" alt="左箭头">
    <div id="img-container">
        <img id="img-current" src="__ROOT__/Public/img/Common/spacer.gif">
    </div>
    <img src="__ROOT__/Public/img/Menu/common/next.png" id="right-arrow" alt="右箭头">
</div>
<script>
    mockData = [{
        "subject_id": "43",
        "subject_name": "\u5065\u5eb7\u8bdd\u9898",
        "source_id": "1542855076",
        "content_type": "1",
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122105100.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105103.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105107.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105110.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105113.png"],
        "show_title": "\u4e16\u754c\u6162\u963b\u80ba\u65e5\uff1a\u6cbb\u7597\u6162\u963b\u80ba\u75c5\uff0c\u4e0d\u8a00\u65e9\u3001\u4e0d\u653e\u5f03\uff01",
        "title": "\u4e16\u754c\u6162\u963b\u80ba\u65e5\uff1a\u6cbb\u7597\u6162\u963b\u80ba\u75c5\uff0c\u4e0d\u8a00\u65e9\u3001\u4e0d\u653e\u5f03\uff01",
        "image_url": "",
        "ftp_url": "",
        "user_type": "0",
        "free_seconds": "0",
        "intro_image_url": "",
        "intro_txt": "",
        "price": "0",
        "valid_duration": "0"
    }, {
        "subject_id": "43",
        "subject_name": "\u5065\u5eb7\u8bdd\u9898",
        "source_id": "1542855044",
        "content_type": "1",
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122105019.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105022.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105026.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105030.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105032.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105036.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105040.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122105043.png"],
        "show_title": "\u8fd9\u79cd\u5987\u79d1\u75c597%\u5973\u6027\u90fd\u5f97\u8fc7\uff0c\u4f60\u771f\u7684\u7406\u89e3\u9634\u9053\u708e\u5417\uff1f",
        "title": "\u8fd9\u79cd\u5987\u79d1\u75c597%\u5973\u6027\u90fd\u5f97\u8fc7\uff0c\u4f60\u771f\u7684\u7406\u89e3\u9634\u9053\u708e\u5417\uff1f",
        "image_url": "",
        "ftp_url": "",
        "user_type": "0",
        "free_seconds": "0",
        "intro_image_url": "",
        "intro_txt": "",
        "price": "0",
        "valid_duration": "0"
    }, {
        "subject_id": "43",
        "subject_name": "\u5065\u5eb7\u8bdd\u9898",
        "source_id": "1542854995",
        "content_type": "1",
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }, {
        "content_desc": ["\/imgs\/630092\/videosubject\/content\/43\/20181122104942.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104946.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104948.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104951.png", "\/imgs\/630092\/videosubject\/content\/43\/20181122104954.png"],
        "show_title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
        "title": "\u8840\u7cd6\u6d53\u5ea6\u5347\u9ad8\u4e86\uff0c\u627e\u627e\u662f\u4ec0\u4e48\u539f\u56e0",
    }]; //专题节目列表;


    window.onload = function () {

        renderList();
        onFocusChangeBg({id: "focus-1", cIdx: 0}, true);
        LMEPG.ButtonManager.init(["focus-1"], buttons, '', true);
    };

    var buttons = [{
        id: 'back',
        name: '返回',
        type: 'img',
        nextFocusDown: 'focus-1',
        click: "",
        backgroundImage: "__ROOT__/Public/img/Menu/QHotherPages/back.png",
        focusImage: "__ROOT__/Public/img/Menu/QHotherPages/back_f.png",
    }];
    /**
     * 渲染图文标题
     */
    var page = 0;
    var currentData = null;

    function renderList() {

        var htm = '';
        currentData = mockData.slice(page * 8, page * 8 + 8);
        currentData.forEach(function (item, index) {
            htm += '<li id=focus-' + (index + 1) + '>' + item.title + '</li>';
            buttons.push({
                id: 'focus-' + (index + 1),
                name: '',
                type: 'img',
                nextFocusUp: 'focus-' + (index),
                nextFocusDown: 'focus-' + (index + 2),
                click: enterKey,
                focusChange: onFocusChangeBg,
                beforeMoveChange: turnPage,
                cIdx: index,
            })
        });
        G("item-wrapper").innerHTML = htm;
        G("page-index").innerText = (page + 1) + "/" + Math.ceil(mockData.length / 8);
    }

    /**
     * 图文标题获得、失去焦点操作
     * @param btn
     * @param Focus
     */
    function onFocusChangeBg(btn, Focus) {

        var currentDom = G(btn.id);
        var text = currentDom.innerText;
        if (Focus) {
            currentDom.className = "focus";
            currentDom.innerHTML = "<marquee>" + text + "</marquee>";
            var httpImg = currentData[btn.cIdx].content_desc;
            createImg(httpImg);
        } else {
            currentDom.className = "";
            currentDom.innerHTML = text;
        }
    }

    /**
     * 翻页
     * @param key
     * @param btn
     */
    function turnPage(key, btn) {
        switch (key) {
            case "up":
                btn.id == "focus-1" && prevPage(btn);
                break;
            case "down":
                btn.id == "focus-8" && nextPage();
                break;
            case "left":
                prevPage();
                break;
            case "right":
                nextPage();
                break;
        }
    }

    /**
     * 上一页
     */
    function prevPage(btn) {
        btn = btn ? btn : "";
        if (page == 0 && btn.id == "focus-1") {
            LMEPG.ButtonManager.requestFocus("back");
        } else {
            page = Math.max(0, page -= 1);
            renderList();
            LMEPG.ButtonManager.requestFocus(buttons[buttons.length - 1].id);
        }
    }

    /**
     * 下一页
     */
    function nextPage() {
        page = Math.min(Math.floor(mockData.length / 8), page += 1);
        renderList();
        LMEPG.ButtonManager.requestFocus("focus-1");
    }

    /**
     * enter键入操作
     */
    var saveCurrentId;

    function enterKey(btn) {
        saveCurrentId = btn.id;
        buttons.unshift({
            id: 'img-container',
            name: '图文容器',
            click: onBack,
            beforeMoveChange: renderImg,
            cIdx: btn.cIdx
        });
        renderImg("", btn);
        LMEPG.ButtonManager.init(["img-container"], buttons, '', true);
        Show("iframe");
        iframe = true;
    }

    /**
     * 渲染图文数据
     * @param key
     * @param btn
     */
    var count = 0;
    var loader = [];
    var iframe = false;

    function renderImg(key, btn) {

        var imgWrap = G('img-container');
        var httpImg = currentData[btn.cIdx].content_desc;
        count = key === 'left' ? Math.max(1, count -= 1) : Math.min(httpImg.length, count += 1);
        imgWrap.replaceChild(loader[count - 1], imgWrap.firstElementChild);
        arrow(count - 1, httpImg.length - 1);
    }

    /**
     * 创建当前焦点对应标题的图片数组
     * @param httpImg
     */
    function createImg(httpImg) {
        count = 0;
        loader = [];
        httpImg.forEach(function (item) {
            var img = new Image();
            img.src = 'http://223.221.36.146:10002/fs' + item;
            loader.push(img);
        });
    }

    /**
     * 图片当前个数
     * @param imgCount
     * @param lastImgIndex
     */
    function arrow(imgCount, lastImgIndex) {

        Show('left-arrow');
        Show('right-arrow');

        imgCount === 0 && Hide('left-arrow');
        imgCount === lastImgIndex && Hide('right-arrow');
    }

    function onBack() {
        if (iframe) {
            Hide("iframe");
            LMEPG.ButtonManager.init([saveCurrentId], buttons, '', true);
        } else {
            LMEPG.Intent.back();
        }

    }
</script>
</body>
</html>