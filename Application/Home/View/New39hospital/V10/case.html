<!DOCTYPE html>
<html lang="en">
<head>
    <title>患者案例-V10</title>
    <meta charset="utf-8" name="page-view-size" content="{$size}">
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/{$platformType}/common.css?t={$time}"/>
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/hd/New39hospital/V10/case.css?t={$time}"/>

    <!--全局渲染参数-->
    <script type="text/javascript">
        var RenderParam = {
            //公共渲染
            accountId: "{$accountId}",          // 账号
            carrierId: "{$carrierId}",          // 地区id
            areaCode: "{$areaCode}",            // 省份地区码
            platformType: "{$platformType}",    // 平台类型
            debug: "{$debug}",                  // 调试模式
            pageSize: "{$size}",                // 页面尺寸
            stbModel: "{$stbModel}",            // 盒子的型号
            fsUrl: "{$resourcesUrl}",           // fs 地址
            time: "{$time}",                    // 开始渲染时间
            isVip: "{$isVip}",                  // 用户是否是vip
            userId: "{$userId}",                // 用户Id
        };
    </script>

    <!--第三方依赖库-->
    <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/json2.js?t={$time}"></script>
    <switch name="carrierId">
        <case value="520094">     <!--贵州广电js文件-->
            <script type="text/javascript" src="http://epg.interface.gzgd/nn_cms/data/webapp/common/gzgd.config.js?t={$time}"></script>
            <script type="text/javascript" src="http://epg.interface.gzgd/nn_cms/data/webapp/common/starcorCom.js?t={$time}"></script>
            <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/520094/gzgd.config.js?t={$time}"></script>
            <script type="text/javascript" src="__ROOT__/Public/ThirdParty/js/520094/starcorCom.js?t={$time}"></script>
        </case>
    </switch>
    <!--公共库-->
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmcommon.js?t={$time}"></script>
<eq name="isRunOnAndroid" value="1">
    <script type="text/javascript" src="__ROOT__/Public/Common/js/android.js?t={$time}"></script>
</eq>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmui.js?t={$time}"></script>
    <script type="text/javascript" src="__ROOT__/Public/Common/js/lmplayer_gzgd.js?t={$time}"></script>
</head>
<body>
<img id="bodyImg" src="__ROOT__/Public/img/hd/New39hospital/V10/bg-002.png"/>
<img id="bodyDefaultImg" src="__ROOT__/Public/img/hd/New39hospital/V10/bg.png"/>

<div id="container-left">
    <div id="logo"></div>
    <ul id="nav">
        <li id="tab-home">首页</li>
        <li id="tab-experts">顶级专家</li>
        <li id="tab-guide">就诊指南</li>
        <li id="tab-case">患者案例</li>
        <div id="tab-order">立即咨询</div>
    </ul>
    <div id="qr-code">
        <img align="bottom" src="__ROOT__/Public/img/hd/New39hospital/V10/qr_code.png" alt="">
        <p id="qr-code-desc">扫描下载39互联网医院手机应用</p>
    </div>
</div>
<img src="__ROOT__/Public/img/hd/New39hospital/V10/up.png" id="pre-arrow" alt="">
<div id="debug" style="position: absolute;z-index: 100; top: 0px"></div>

<div id="container-right">
    <div id="content-case">
        <div id="content-case-video"></div>
    </div>
</div>
<img src="__ROOT__/Public/img/hd/New39hospital/V10/down.png" id="next-arrow" alt="">
<p id="service-tel">全国免费客服热线：400-061-3939</p>
<div id="case_detail_whole">
    <img id="case_detail_bg" src="__ROOT__/Public/img/hd/Home/V10/bg.png">
    <div id="case_detail_text">
        <p id="case_detail_title"></p>
        <div id="case_detail"></div>
    </div>
</div>
<script>
    /**
     * 返回事件
     */
    function onBack() {
        if (LMEPG.BM.getCurrentButton().id == "case_detail") {
            Hide("case_detail_whole");
            LMEPG.BM.requestFocus("container-right");
        } else {
            LMEPG.Intent.back();
        }
    }
</script>

<script>
    var index = 0;
    var dataLength = 0;
    var dataInfo;
    var InitData = {
        pageCurr: 1,
        caseInfo: ""
    };
    var Constat = {
        fileIndex: "__ROOT__/Public/img/hd/New39hospital/V10/",
    };
    var buttons = [
        {
            id: "tab-case",
            name: "患者案例",
            type: 'div',
            nextFocusUp: 'tab-guide',
            nextFocusDown: 'tab-order',
            backgroundImage: Constat.fileIndex + "case.png",
            focusImage: Constat.fileIndex + "case_hover.png",
            selectedImage: Constat.fileIndex + "case_active.png",
            active: false,
            focusChange: onFocus,
            click: "",
            beforeMoveChange: onBeforeMoveChange,
            groupId: "department",
        }, {
            id: "tab-order",
            name: "立即咨询按钮",
            type: 'div',
            nextFocusUp: 'tab-case',
            backgroundImage: Constat.fileIndex + "order.png",
            focusImage: Constat.fileIndex + "order_hover.png",
            selectedImage: Constat.fileIndex + "order_active.png",
            focusChange: onFocus,
            click: "",
            beforeMoveChange: onBeforeMoveChange,
            groupId: "department",
        }, {
            id: "container-right",
            name: "右边内容视图",
            type: 'img',
            focusChange: onFocus,
            click: rightClick,
            beforeMoveChange: onBeforeMoveChange,
        }, {
            id: "case_detail",
            name: "患者案例详情",
            type: 'img',
            focusChange: '',
            click: '',
            beforeMoveChange: onBeforeMoveChange,
        }];


    /**
     * 获取焦点后操作
     * */
    function onFocus(btn, hasFocus) {
        switch (btn.id) {
            case "container-right":
                if (hasFocus) {
                    G("content-case").style.backgroundImage = "url('" + Constat.fileIndex + 'case_selected.png' + "')";
                } else {
                    G("content-case").style.backgroundImage = "url('__ROOT__/Public/img/Common/spacer.gif')";
                }
                break;
            default:
                var pdname = btn.id.slice(0, 3);
                if (hasFocus) {
                    G(btn.id).style.color = "#ffffff";
                } else {
                    var currentId = LMEPG.ButtonManager.getSelectedButton("department").id;
                    G(currentId).style.color = "#000";
                }
                break;
        }

    }

    /**
     * 焦点移动后的操作
     */
    function onBeforeMoveChange(direction, current) {
        switch (direction) {
            case "up":
                if (current.id == "container-right") {
                    prevPage();
                } else if (current.id == "tab-case") {
                    jumpGuideUI();
                } else {
                }
                break;
            case "down":
                if (current.id == "container-right") {
                    nextPage();
                } else if (current.id == "tab-case") {
                    jumpConsultUI();
                } else {
                }
                break;
            case "left":
                LMEPG.ButtonManager.requestFocus("tab-case");
                break;
            case "right":
                LMEPG.ButtonManager.requestFocus("container-right");
                break;
        }
    }


    function getCurrentPageUI() {
        return LMEPG.Intent.createIntent("Hospital39Case");
    }

    function jumpGuideUI() {
        var nextPage = LMEPG.Intent.createIntent("Hospital39Guide");
        LMEPG.Intent.jump(nextPage, getCurrentPageUI(), LMEPG.Intent.INTENT_FLAG_NOT_STACK);
    }

    function jumpConsultUI() {
        var nextPage = LMEPG.Intent.createIntent("Hospital39Consult");
        LMEPG.Intent.jump(nextPage, getCurrentPageUI(), LMEPG.Intent.INTENT_FLAG_NOT_STACK);
    }


    window.onload = function (ev) {
        LMEPG.ButtonManager.init("tab-case", buttons, "", true);
        LMEPG.ButtonManager.setSelected("tab-case", true);
        getHomeVideo();
    };

    function getHomeVideo() {
        LMEPG.ajax.postAPI("Hospital39/getCase", {}, function (data) {
            try {
                if (data.result == 0) {
                    dataLength = data.list.length;
                    dataInfo = data;
                    caseInfo(dataInfo);
                }
            } catch (e) {
                LMEPG.UI.showToast(e);
            }


        });
    }
    function caseInfo(data) {
//        InitData.caseInfo = data;
        var tempObj = data.list[index];
        var tempCount = data.count;
        var tempImgUrl = RenderParam.fsUrl + tempObj.title_image_url;
        var tempTitle = tempObj.two_level_title;
        var caseViewHtml = '<p class="static-title">把健康还给你 - 身边人，身边事 <span class="static-title-child">患者案例介绍</span></p>' +
                '                   <img id="case-img" src="'+tempImgUrl+'" >' +
                '                   <div id="case-picture-title">' + tempTitle + '</div>    ' +
                '                   <div id="case-num">' + (index + 1) + '/' + dataLength + '</div>';
        G("content-case-video").innerHTML = caseViewHtml;
        G("case-picture-title").style.backgroundImage = 'url("__ROOT__/Public/img/hd/New39hospital/word_title.png")';
        arrow();
    }

    function prevPage() {
        if (index > 0) {
            index--;
            caseInfo(dataInfo);
        } else {

        }
    }

    function nextPage() {
        if (parseInt(dataLength - index) > 1) {
            index++;
            caseInfo(dataInfo);
        } else {

        }
    }
    //箭头指示
    function arrow() {
        setDisplay(G("pre-arrow"), 'none');
        setDisplay(G("next-arrow"), 'none');
        if (index > 0) {
            setDisplay(G("pre-arrow"), 'block');
        }
        if (parseInt(dataLength - index) > 1) {
            setDisplay(G("next-arrow"), 'block');
        }
    }
    function setDisplay(el, val) {
        el.style.display = val;
    }

    /**
     *
     */
    function rightClick() {
        //点击的是患者案例
        Show("case_detail_whole");
        G("case_detail_title").innerHTML = dataInfo.list[index].two_level_title;
        var content = dataInfo.list[index].content.replace(/src="/g, 'src="' + RenderParam.fsUrl);
        G("case_detail").innerHTML = content;
        LMEPG.BM.requestFocus("case_detail");
    }

</script>

</body>
</html>